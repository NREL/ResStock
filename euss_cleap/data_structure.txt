Community list: ["louisville", "san_jose", "columbia", "north_birmingham", "jackson_county", "duluth", "lawrence", "hill_district"]
0. conda environment:
create a conda environment of resstock-estimation (https://github.com/NREL/resstock-estimation)

1. downsample_buildstock.py
input data directory: requires results_up00 file, download the file from AWS and revise the path code in downsample_buildstock.py
run python downsample_buildstock.py in ther terminal
output data directory:data_/downsampled_buildings_id/euss1_2018_results_up00__downsampled_method1_{community}.csv

# Not available for hill_district as a small EUSS run is done separately with ~2k samples to add XPS for masonry walls.

2. get_com_euss.ipynb
Extract raw EUSS files for community informed by downsampled output.
Note: add_envelope_metrics.py (which can be run independently) is invoked in the notebook to add envelope ratings directly into the raw baseline file.
input data directory: data_/downsampled_buildings_id/euss1_2018_results_up00__downsampled_method1_{community}.csv 
                      data_/euss_res_final_2018_550k_20220901/
output data directory: data_/community_building_samples/{community}/
# Not needed for hill_district, however, run $ python add_envelope_metrics.py hill_district to add envelope ratings into raw baseline file.

2B. add_duct_conditioned_surface_area_and_cost.py <community>
Correct duct inconsistencies and costs in results. 
Add "hvac_has_ducts" and "duct_location" to baseline file.
Add "duct_conditioned_surface_area", "duct_unconditioned_surface_area", "duct_total_surface_area" to baseline and upgrade files. Use "duct_total_surface_area" for upgrade cost calc.
Override relevant "upgrade_costs.option_<>" columns and "upgrade_costs.upgrade_cost_usd" in upgrade files, remove buildings that no longer has an upgrade after duct fix.
input data directory: data_/community_building_samples/{community}/up<#>.parquet
output data directory: data_/community_building_samples/{community}/up<#>_duct_corrected.parquet

3. upgrade_cost_and_bill.py <community>
Use upgrade_cost_and_bill_validate.py <community> to validate
input data directory: data_/community_building_samples/{community}/up_<#>_duct_corrected.parquet
                      data_/community_cost/cost_{community}.csv
output data directory: data_/community_building_samples_with_upgrade_cost_and_bill/{community}/
# A separate processing script is available for hill_district due to the addition of XPS for masonry walls.
# $ python upgrade_cost_and_bill_hill_district.py


4. process_annual_summary_for_factsheets.py <community>
input data directory: data_/community_building_samples_with_upgrade_cost_and_bill/{community}/
Secondarily requires the following input data:
   - data_ami/ : lookup files for add_ami_to_euss_annual_summary.py, 
available as data_ami.zip here: https://nrel.sharepoint.com/sites/CBldgStock-ResStockC-LEAP/Shared%20Documents/Forms/AllItems.aspx?id=%2Fsites%2FCBldgStock%2DResStockC%2DLEAP%2FShared%20Documents%2FCommunity%20Factsheets%2FDashboards%20and%20Data&viewid=5cafc4af%2D3d45%2D472a%2Daf4a%2D6ce12b8614cf
   - data/Res Facades v1 2019/ : 2019 state-average utility rates
   - data/Res Facades v2 2021/ : 2021 state-average utility rates
both available here: https://nrel.sharepoint.com/sites/CBldgStock-ResStockC-LEAP/Shared%20Documents/Forms/AllItems.aspx?id=%2Fsites%2FCBldgStock%2DResStockC%2DLEAP%2FShared%20Documents%2FCommunity%20Factsheets%2FDashboards%20and%20Data%2FUtility%20Rates%20from%20Elaina&viewid=5cafc4af%2D3d45%2D472a%2Daf4a%2D6ce12b8614cf

5. TOU_calculation.py (change the community name and monthly fixed fee) or run tiered_bill_calcualtion.py (change the community name and tired price)
input data directory: data_/community_building_samples_with_upgrade_cost_and_bill/{community}/processed_upgrade_results.parquet
                      data_/community_cost/TOU_{community}_weekday_cost.csv
                      data_/community_cost/TOU_{community}_weekend_cost.csv
output data directory: data_/community_building_samples_with_upgrade_cost_and_bill/{community}/processed_upgrade_results_tired.parquet or processed_upgrade_results_TOU.parquet

6. figure_housing_characteristic.ipynb
input data directory: data_/community_building_samples_with_upgrade_cost_and_bill/{community}/up00__{community}.parquet
output data directory: results/{community}/

7. saving_results_reports_for_{community}.ipynb
input data directory: data_/community_building_samples_with_upgrade_cost_and_bill/{community}/processed_upgrade_results.parquet or processed_upgrade_results_tired.parquet or processed_upgrade_results_TOU.parquet
output data directory: results/{community}/

###
To run panel upgrade estimation for san_jose
$ python add_panel_upgrade.py
